const dataByProdi = {
    'D4 TI': {
        profesi: { 'Lainnya': 25.5, 'Data Analyst': 6.4, 'Customer Service': 5.1, 'Product QA': 3.8, 'Teknisi': 1.3, 'Perekayasa PL': 31.8, 'Start IT': 10.8, 'Marketing': 5.1, 'Usaha': 10.2 },
        instansi: { 'Pendidikan Tinggi': 10, 'Instansi Pemerintah': 30, 'Perusahaan Swasta': 50, 'BUMN': 10 },
        kepuasanPenggunaLulusan1: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan2: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan3: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan4: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan5: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan6: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan7: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        table: [
            { tahun: 2021, jumlahLulusan: 213, terlacak: 64, infokom: 46, nonInfokom: 18, multi: 0, nasional: 63, wirausaha: 1 },
            { tahun: 2022, jumlahLulusan: 188, terlacak: 115, infokom: 73, nonInfokom: 42, multi: 4, nasional: 108, wirausaha: 3 },
            { tahun: 2023, jumlahLulusan: 233, terlacak: 98, infokom: 70, nonInfokom: 28, multi: 2, nasional: 90, wirausaha: 6 },
            { tahun: 2024, jumlahLulusan: 200, terlacak: 112, infokom: 82, nonInfokom: 30, multi: 3, nasional: 107, wirausaha: 2 }
        ],
        tableMasaTunggu: [
            { tahun: 2021, jumlahLulusan: 213, terlacak: 64, masaTunggu: 4.92 },
            { tahun: 2022, jumlahLulusan: 188, terlacak: 115, masaTunggu: 4.77 },
            { tahun: 2023, jumlahLulusan: 233, terlacak: 98, masaTunggu: 3.38 },
            { tahun: 2024, jumlahLulusan: 200, terlacak: 112, masaTunggu: 6.01 }
        ]
    },
    'D4 SIB': {
        profesi: { 'Lainnya': 20, 'Data Analyst': 10, 'Customer Service': 5, 'Product QA': 5, 'Teknisi': 2, 'Perekayasa PL': 28, 'Start IT': 12, 'Marketing': 8, 'Usaha': 10 },
        instansi: { 'Pendidikan Tinggi': 15, 'Instansi Pemerintah': 25, 'Perusahaan Swasta': 45, 'BUMN': 15 },
        kepuasanPenggunaLulusan1: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan2: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan3: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan4: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan5: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan6: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan7: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        table: [
            { tahun: 2021, jumlahLulusan: 180, terlacak: 50, infokom: 40, nonInfokom: 10, multi: 1, nasional: 48, wirausaha: 1 },
            { tahun: 2022, jumlahLulusan: 190, terlacak: 90, infokom: 60, nonInfokom: 30, multi: 3, nasional: 85, wirausaha: 2 },
            { tahun: 2023, jumlahLulusan: 210, terlacak: 80, infokom: 55, nonInfokom: 25, multi: 2, nasional: 76, wirausaha: 2 },
            { tahun: 2024, jumlahLulusan: 195, terlacak: 100, infokom: 70, nonInfokom: 30, multi: 4, nasional: 94, wirausaha: 2 }
        ],
        tableMasaTunggu: [
            { tahun: 2021, jumlahLulusan: 213, terlacak: 64, masaTunggu: 4.92 },
            { tahun: 2022, jumlahLulusan: 188, terlacak: 115, masaTunggu: 4.77 },
            { tahun: 2023, jumlahLulusan: 233, terlacak: 98, masaTunggu: 3.38 },
            { tahun: 2024, jumlahLulusan: 200, terlacak: 112, masaTunggu: 6.01 }
        ]
    },
    'D2 PPLS': {
        profesi: { 'Lainnya': 30, 'Data Analyst': 5, 'Customer Service': 10, 'Product QA': 2, 'Teknisi': 3, 'Perekayasa PL': 25, 'Start IT': 8, 'Marketing': 7, 'Usaha': 10 },
        instansi: { 'Pendidikan Tinggi': 20, 'Instansi Pemerintah': 20, 'Perusahaan Swasta': 40, 'BUMN': 20 },
        kepuasanPenggunaLulusan1: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan2: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan3: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan4: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan5: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan6: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan7: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        table: [
            { tahun: 2021, jumlahLulusan: 150, terlacak: 40, infokom: 30, nonInfokom: 10, multi: 0, nasional: 38, wirausaha: 2 },
            { tahun: 2022, jumlahLulusan: 160, terlacak: 70, infokom: 50, nonInfokom: 20, multi: 2, nasional: 66, wirausaha: 2 },
            { tahun: 2023, jumlahLulusan: 170, terlacak: 60, infokom: 45, nonInfokom: 15, multi: 1, nasional: 57, wirausaha: 2 },
            { tahun: 2024, jumlahLulusan: 165, terlacak: 80, infokom: 60, nonInfokom: 20, multi: 3, nasional: 75, wirausaha: 2 }
        ],
        tableMasaTunggu: [
            { tahun: 2021, jumlahLulusan: 213, terlacak: 64, masaTunggu: 4.92 },
            { tahun: 2022, jumlahLulusan: 188, terlacak: 115, masaTunggu: 4.77 },
            { tahun: 2023, jumlahLulusan: 233, terlacak: 98, masaTunggu: 3.38 },
            { tahun: 2024, jumlahLulusan: 200, terlacak: 112, masaTunggu: 6.01 }
        ]
    },
    'S2 MRTI': {
        profesi: { 'Lainnya': 15, 'Data Analyst': 15, 'Customer Service': 3, 'Product QA': 5, 'Teknisi': 2, 'Perekayasa PL': 35, 'Start IT': 15, 'Marketing': 5, 'Usaha': 5 },
        instansi: { 'Pendidikan Tinggi': 25, 'Instansi Pemerintah': 25, 'Perusahaan Swasta': 40, 'BUMN': 10 },
        kepuasanPenggunaLulusan1: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan2: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan3: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan4: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan5: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan6: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        kepuasanPenggunaLulusan7: { 'Kurang': 2.50, 'Cukup': 2.50, 'Baik': 2.50, 'Sangat Baik': 2.50 },
        table: [
            { tahun: 2021, jumlahLulusan: 100, terlacak: 30, infokom: 25, nonInfokom: 5, multi: 2, nasional: 28, wirausaha: 0 },
            { tahun: 2022, jumlahLulusan: 110, terlacak: 50, infokom: 40, nonInfokom: 10, multi: 3, nasional: 47, wirausaha: 0 },
            { tahun: 2023, jumlahLulusan: 120, terlacak: 45, infokom: 35, nonInfokom: 10, multi: 2, nasional: 42, wirausaha: 1 },
            { tahun: 2024, jumlahLulusan: 115, terlacak: 60, infokom: 50, nonInfokom: 10, multi: 4, nasional: 55, wirausaha: 1 }
        ],
        tableMasaTunggu: [
            { tahun: 2021, jumlahLulusan: 213, terlacak: 64, masaTunggu: 4.92 },
            { tahun: 2022, jumlahLulusan: 188, terlacak: 115, masaTunggu: 4.77 },
            { tahun: 2023, jumlahLulusan: 233, terlacak: 98, masaTunggu: 3.38 },
            { tahun: 2024, jumlahLulusan: 200, terlacak: 112, masaTunggu: 6.01 }
        ]
    }
};

let profesiChart, instansiChart, kepuasanPenggunaLulusan1, kepuasanPenggunaLulusan2, kepuasanPenggunaLulusan3, kepuasanPenggunaLulusan4, kepuasanPenggunaLulusan5, kepuasanPenggunaLulusan6, kepuasanPenggunaLulusan7;

// Initialize Charts
function initializeCharts(prodiData) {
    if (profesiChart) profesiChart.destroy();
    if (instansiChart) instansiChart.destroy();
    if (kepuasanPenggunaLulusan1) kepuasanPenggunaLulusan1.destroy();
    if (kepuasanPenggunaLulusan2) kepuasanPenggunaLulusan2.destroy();
    if (kepuasanPenggunaLulusan3) kepuasanPenggunaLulusan3.destroy();
    if (kepuasanPenggunaLulusan4) kepuasanPenggunaLulusan4.destroy();
    if (kepuasanPenggunaLulusan5) kepuasanPenggunaLulusan5.destroy();
    if (kepuasanPenggunaLulusan6) kepuasanPenggunaLulusan6.destroy();
    if (kepuasanPenggunaLulusan7) kepuasanPenggunaLulusan7.destroy();

    profesiChart = new Chart(document.getElementById('sebaranProfesiChart'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.profesi),
            datasets: [{
                data: Object.values(prodiData.profesi),
                backgroundColor: ['#d1d5db', '#f87171', '#facc15', '#34d399', '#60a5fa', '#3b82f6', '#f97316', '#a78bfa', '#f59e0b'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Grafik Sebaran Profesi Lulusan',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            let label = context.label || '';
                            if (label) label += ': ';
                            return label + context.raw + '%';
                        }
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    instansiChart = new Chart(document.getElementById('sebaranInstansiChart'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.instansi),
            datasets: [{
                data: Object.values(prodiData.instansi),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Grafik Sebaran Jenis Instansi',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Kerjasama Tim
    kepuasanPenggunaLulusan1 = new Chart(document.getElementById('kepuasanPenggunaLulusan1'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan1),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan1),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Kerjasama Tim',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Keahlian di Bidang TI
    kepuasanPenggunaLulusan2 = new Chart(document.getElementById('kepuasanPenggunaLulusan2'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan2),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan2),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Keahlian di Bidang TI',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Kemampuan berbahasa Asing (Inggris)
    kepuasanPenggunaLulusan3 = new Chart(document.getElementById('kepuasanPenggunaLulusan3'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan3),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan3),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Kemampuan berbahasa Asing (Inggris)',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Kemampuan Berkomunikasi
    kepuasanPenggunaLulusan4 = new Chart(document.getElementById('kepuasanPenggunaLulusan4'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan4),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan4),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Kemampuan Berkomunikasi',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Pengembangan Diri
    kepuasanPenggunaLulusan5 = new Chart(document.getElementById('kepuasanPenggunaLulusan5'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan5),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan5),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Pengembangan Diri',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Kepemimpinan
    kepuasanPenggunaLulusan6 = new Chart(document.getElementById('kepuasanPenggunaLulusan6'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan6),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan6),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Kepemimpinan',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });

    // Etos Kerja
    kepuasanPenggunaLulusan7 = new Chart(document.getElementById('kepuasanPenggunaLulusan7'), {
        type: 'pie',
        data: {
            labels: Object.keys(prodiData.kepuasanPenggunaLulusan7),
            datasets: [{
                data: Object.values(prodiData.kepuasanPenggunaLulusan7),
                backgroundColor: ['#fde047', '#f87171', '#60a5fa', '#34d399'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Etos Kerja',
                    font: { size: 16, weight: '600' },
                    color: '#1e3a8a',
                    padding: { bottom: 10 }
                },
                legend: {
                    position: 'right',
                    labels: {
                        font: { size: 12 },
                        color: '#374151',
                        padding: 12,
                        boxWidth: 12
                    }
                }
            },
            animation: {
                duration: 1500,
                easing: 'easeInOutQuad'
            }
        }
    });
}

// Update Table (simplified without percentages)
function updateTable(prodiData, tahunAwal, tahunAkhir) {
    const tbody = document.getElementById('table-body');
    const tfoot = document.getElementById('table-footer');
    tbody.innerHTML = '';

    let totals = {
        jumlahLulusan: 0,
        terlacak: 0,
        infokom: 0,
        nonInfokom: 0,
        multi: 0,
        nasional: 0,
        wirausaha: 0
    };

    prodiData.table.forEach(row => {
        if (row.tahun >= tahunAwal && row.tahun <= tahunAkhir) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.tahun}</td>
                <td>${row.jumlahLulusan.toLocaleString()}</td>
                <td>${row.terlacak.toLocaleString()}</td>
                <td>${row.infokom.toLocaleString()}</td>
                <td>${row.nonInfokom.toLocaleString()}</td>
                <td>${row.multi.toLocaleString()}</td>
                <td>${row.nasional.toLocaleString()}</td>
                <td>${row.wirausaha.toLocaleString()}</td>
            `;
            tbody.appendChild(tr);

            // Update totals
            totals.jumlahLulusan += row.jumlahLulusan;
            totals.terlacak += row.terlacak;
            totals.infokom += row.infokom;
            totals.nonInfokom += row.nonInfokom;
            totals.multi += row.multi;
            totals.nasional += row.nasional;
            totals.wirausaha += row.wirausaha;
        }
    });

    // Add totals row
    tfoot.innerHTML = `
        <tr>
            <td>Total</td>
            <td>${totals.jumlahLulusan.toLocaleString()}</td>
            <td>${totals.terlacak.toLocaleString()}</td>
            <td>${totals.infokom.toLocaleString()}</td>
            <td>${totals.nonInfokom.toLocaleString()}</td>
            <td>${totals.multi.toLocaleString()}</td>
            <td>${totals.nasional.toLocaleString()}</td>
            <td>${totals.wirausaha.toLocaleString()}</td>
        </tr>
    `;
}

// Update Table Masa Tunggu
function updateTableMasaTunggu(prodiData, tahunAwal, tahunAkhir) {
    const tbody = document.getElementById('body-masa-tunggu');
    const tfoot = document.getElementById('footer-masa-tunggu');

    tbody.innerHTML = '';
    tfoot.innerHTML = '';

    const filtered = prodiData.tableMasaTunggu.filter(row => row.tahun >= tahunAwal && row.tahun <= tahunAkhir);

    let totalLulusan = 0;
    let totalTerlacak = 0;
    let totalTunggu = 0;

    filtered.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="text-center">${row.tahun}</td>
            <td class="text-center">${row.jumlahLulusan}</td>
            <td class="text-center">${row.terlacak}</td>
            <td class="text-center">${row.masaTunggu.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);

        totalLulusan += row.jumlahLulusan;
        totalTerlacak += row.terlacak;
        totalTunggu += row.masaTunggu * row.terlacak; // Weighted
    });

    const rataRata = totalTerlacak ? (totalTunggu / totalTerlacak).toFixed(2) : '0.00';

    const trTotal = document.createElement('tr');
    trTotal.innerHTML = `
        <td class="text-center font-bold">Total</td>
        <td class="text-center font-bold">${totalLulusan}</td>
        <td class="text-center font-bold">${totalTerlacak}</td>
        <td class="text-center font-bold">${rataRata}</td>
    `;
    tfoot.appendChild(trTotal);
}

// Filter Handler
document.getElementById('apply-filter').addEventListener('click', function () {
    const prodi = document.getElementById('prodi').value;
    const tahunAwal = parseInt(document.getElementById('tahun_awal').value);
    const tahunAkhir = parseInt(document.getElementById('tahun_akhir').value);

    if (tahunAwal > tahunAkhir) {
        alert('Tahun Awal tidak boleh lebih besar dari Tahun Akhir!');
        return;
    }

    document.getElementById('prodi-display').textContent = prodi;
    document.getElementById('tahun-display').textContent = `${tahunAwal} - ${tahunAkhir}`;

    initializeCharts(dataByProdi[prodi]);
    updateTable(dataByProdi[prodi], tahunAwal, tahunAkhir);
    updateTableMasaTunggu(dataByProdi[prodi], tahunAwal, tahunAkhir);
});